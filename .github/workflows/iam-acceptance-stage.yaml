name: Iam - Acceptance stage

on:
  workflow_run:
    workflows:
      - Iam - Commit stage
    types:
      - completed

env:
  PHP_EXTENSIONS: ctype, iconv, json, curl, gd, intl, opcache, openssl, mbstring, mysql, pdo_sqlite
  PHP_EXTENSIONS_CACHE_KEY: cache-php-extensions-v1


defaults:
  run:
    shell: bash
    working-directory: iam


jobs:
  on-iam-commit-stage-success:
    runs-on: ubuntu-18.04
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Checkout on branch ${{ github.event.workflow_run.head_branch }}
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.workflow_run.head_branch }}

      - name: info triggering workflow - branch name
        run: echo ${{ github.event.workflow_run.head_branch }}

      - name: info triggering workflow - SHA ${{ github.event.workflow_run.head_commit.id }}
        run: echo SHA from triggering workflow ${{ github.event.workflow_run.head_commit.id }}

      - name: info triggering workflow - commit message
        run: echo commit message from triggering workflow '${{ github.event.workflow_run.head_commit.message }}'

      - name: info triggering workflow - author '${{ github.event.workflow_run.head_commit.author.name }}' -'${{ github.event.workflow_run.head_commit.author.email }}'
        run: echo author '${{ github.event.workflow_run.head_commit.author.name }}' -'${{ github.event.workflow_run.head_commit.author.email }}'

      - name: info triggering workflow - committer '${{ github.event.workflow_run.head_commit.committer.name }}' -'${{ github.event.workflow_run.head_commit.committer.email }}'
        run: echo author '${{ github.event.workflow_run.head_commit.author.name }}' -'${{ github.event.workflow_run.head_commit.author.email }}'

      - name: Dump GHA Context
        uses: crazy-max/ghaction-dump-context@v1


  placeholder-dump-context:
    runs-on: ubuntu-18.04
    needs: [on-iam-commit-stage-success]
    timeout-minutes: 5
    strategy:
      matrix:
        php:
          - '8.0'
      fail-fast: true

    steps:
      - name: Checkout on ${{ github.event.workflow_run.head_branch }}
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.workflow_run.head_branch }}

      - name: List directory
        run: ls -al